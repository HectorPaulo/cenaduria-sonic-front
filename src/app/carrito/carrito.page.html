<app-header titulo="Mi Carrito"></app-header>

<ion-content [fullscreen]="true" class="bg-white">
  <div class="max-w-lg mx-auto p-4">
    <!-- Carrito vacÃ­o -->
    @if (itemsCarrito.length === 0) {
    <div class="text-center py-16">
      <div class="text-6xl mb-4">ðŸ›’</div>
      <h2 class="text-2xl font-bold text-gray-700 mb-2">
        Tu carrito estÃ¡ vacÃ­o
      </h2>
      <p class="text-gray-500 mb-6">Â¡Agrega algunos productos deliciosos!</p>
      <ion-button routerLink="/menu" color="warning" size="default">
        <ion-label>Ver MenÃº</ion-label>
      </ion-button>
    </div>
    } @else {

    <!-- Header del carrito -->
    <div class="flex justify-between items-center mb-4 mt-16">
      <h2 class="text-2xl font-bold text-white">
        Tu carrito ({{ cantidadItems }} {{ cantidadItems === 1 ? 'producto' :
        'productos' }})
      </h2>
      <ion-button
        fill="clear"
        color="danger"
        size="small"
        (click)="limpiarCarrito()"
      >
        <ion-icon name="trash" slot="icon-only"></ion-icon>
      </ion-button>
    </div>

    <!-- Lista de productos -->
    <div class="space-y-4 mb-6">
      @for (item of itemsCarrito; track item.id) {
      <ion-card color="light" mode="ios" class="shadow-sm">
        <ion-card-content class="p-4">
          <div class="flex gap-4">
            <!-- Imagen del producto -->
            <img
              [src]="item.imagen"
              [alt]="item.nombre"
              class="w-20 h-20 rounded-lg object-cover flex-shrink-0"
            />

            <!-- InformaciÃ³n del producto -->
            <div class="flex-1 min-w-0">
              <div class="flex justify-between items-start mb-2">
                <div>
                  <h3 class="font-semibold text-gray-800">
                    {{ item.nombre }}
                  </h3>
                  <p class="text-xs text-gray-600 line-clamp-2">
                    {{ item.descripcion }}
                  </p>
                </div>
                <ion-button
                  fill="clear"
                  color="danger"
                  size="small"
                  (click)="eliminarItem(item)"
                >
                  <ion-icon
                    name="close"
                    size="small"
                    slot="icon-only"
                    class="text-sm"
                  ></ion-icon>
                </ion-button>
              </div>

              <!-- Extras -->
              @if (item.extras && item.extras.length > 0) {
              <div class="mb-2">
                @for (extra of item.extras; track $index) {
                <ion-chip class="bg-blue-100 text-blue-800 text-xs mr-1 mb-1">
                  <ion-label>{{ extra }}</ion-label>
                </ion-chip>
                }
              </div>
              }

              <!-- Precio y controles -->
              <div class="flex justify-between items-center">
                <span class="font-bold text-green-300"
                  >${{ (item.precio * item.cantidad) | number: '1.2-2' }}</span
                >
                <div class="flex items-center gap-2">
                  <ion-button
                    fill="clear"
                    size="small"
                    (click)="disminuirCantidad(item)"
                    [disabled]="item.cantidad <= 1"
                  >
                    <ion-icon
                      name="remove"
                      slot="icon-only"
                      size="small"
                    ></ion-icon>
                  </ion-button>
                  <span
                    class="px-3 py-1 rounded-full text-sm font-semibold min-w-[40px] text-center"
                  >
                    {{ item.cantidad }}
                  </span>
                  <ion-button
                    fill="clear"
                    size="small"
                    (click)="aumentarCantidad(item)"
                  >
                    <ion-icon
                      name="add"
                      slot="icon-only"
                      class="text-sm"
                    ></ion-icon>
                  </ion-button>
                </div>
              </div>
            </div>
          </div>
        </ion-card-content>
      </ion-card>
      }
    </div>

    <!-- Cupones y Propina -->
    <div class="space-y-3 mb-6">

      <ion-button
        mode="ios"
        fill="outline"
        color="secondary"
        expand="block"
        (click)="agregarPropina()"
      >
        <ion-label
          >Agregar propina (${{ propina | number: '1.2-2' }})</ion-label
        >
      </ion-button>
    </div>

    <!-- Resumen de precios -->
    <ion-card color="light" mode="ios" class="shadow-sm mb-6">
      <ion-card-header>
        <ion-card-title class="text-lg font-semibold text-gray-800">
          Resumen del pedido
        </ion-card-title>
      </ion-card-header>
      <ion-card-content class="space-y-2">
        <div class="flex justify-between">
          <span class="text-gray-600">Subtotal:</span>
          <span class="font-semibold">${{ subtotal | number: '1.2-2' }}</span>
        </div>

        @if (descuentoAplicado > 0) {
        <div class="flex justify-between text-green-600">
          <span>Descuento:</span>
          <span>-${{ descuentoAplicado | number: '1.2-2' }}</span>
        </div>
        }

        @if (propina > 0) {
        <div class="flex justify-between">
          <span class="text-gray-600">Propina:</span>
          <span class="font-semibold">${{ propina | number: '1.2-2' }}</span>
        </div>
        }

        <hr class="my-2" />
        <div class="flex justify-between text-lg font-bold text-gray-800">
          <span>Total:</span>
          <span class="text-green-700">${{ total | number: '1.2-2' }}</span>
        </div>
      </ion-card-content>
    </ion-card>

    <!-- MÃ©todos de pago -->
    <div class="mb-6">
      <h3 class="text-lg font-semibold text-gray-800 mb-3">MÃ©todo de pago</h3>
      <div class="grid grid-cols-3 gap-2">
        @for (metodo of metodosPago; track metodo.id) {
        <ion-button
          [fill]="metodoSeleccionado === metodo.id ? 'solid' : 'outline'"
          [color]="metodoSeleccionado === metodo.id ? 'warning' : 'medium'"
          size="small"
          [disabled]="!metodo.disponible"
          (click)="seleccionarMetodoPago(metodo.id)"
          class="flex flex-col h-auto py-3"
        >
          <ion-icon [name]="metodo.icono" class="text-lg mb-1"></ion-icon>
          <span class="text-xs">{{ metodo.nombre }}</span>
        </ion-button>
        }
      </div>
    </div>

    <!-- BotÃ³n de realizar pedido -->
    <ion-button
      expand="block"
      color="success"
      size="large"
      (click)="realizarPedido()"
      class="font-semibold mb-4"
    >
      <ion-label>Realizar Pedido - ${{ total | number: '1.2-2' }}</ion-label>
    </ion-button>

    }
  </div>

  <app-fabbtn></app-fabbtn>
</ion-content>
